import { Directive, Component, ElementRef, Optional } from '@angular/core';
import { ActionBar, ActionItem, NavigationButton, Page } from '@nativescript/core';
import { isBlank } from '../../utils/lang-facade';
import { isInvisibleNode, isView } from '../../views/utils';
import { registerElement } from '../../element-registry';
import * as i0 from "@angular/core";
import * as i1 from "@nativescript/core";
export function isActionItem(view) {
    return view instanceof ActionItem;
}
export function isNavigationButton(view) {
    return view instanceof NavigationButton;
}
export const actionBarMeta = {
    skipAddToDom: true,
    insertChild: (parent, child, next) => {
        if (isInvisibleNode(child)) {
            return;
        }
        else if (isNavigationButton(child)) {
            parent.navigationButton = child;
            child.parentNode = parent;
        }
        else if (isActionItem(child)) {
            addActionItem(parent, child, next);
            child.parentNode = parent;
        }
        else if (isView(child)) {
            parent.titleView = child;
        }
    },
    removeChild: (parent, child) => {
        if (isInvisibleNode(child)) {
            return;
        }
        else if (isNavigationButton(child)) {
            if (parent.navigationButton === child) {
                parent.navigationButton = null;
            }
            child.parentNode = null;
        }
        else if (isActionItem(child)) {
            parent.actionItems.removeItem(child);
            child.parentNode = null;
        }
        else if (isView(child) && parent.titleView && parent.titleView === child) {
            parent.titleView = null;
        }
    },
};
registerElement('ActionBar', () => ActionBar, actionBarMeta);
registerElement('ActionItem', () => ActionItem);
registerElement('NavigationButton', () => NavigationButton);
const addActionItem = (bar, item, next) => {
    if (next) {
        insertActionItemBefore(bar, item, next);
    }
    else {
        appendActionItem(bar, item);
    }
};
const insertActionItemBefore = (bar, item, next) => {
    const actionItems = bar.actionItems;
    const actionItemsCollection = actionItems.getItems();
    const indexToInsert = actionItemsCollection.indexOf(next);
    actionItemsCollection.splice(indexToInsert, 0, item);
    actionItems.setItems(actionItemsCollection);
};
const appendActionItem = (bar, item) => {
    bar.actionItems.addItem(item);
};
export class ActionBarComponent {
    constructor(element, page) {
        this.element = element;
        this.page = page;
        if (!this.page) {
            throw new Error('No Page found in ActionBarComponent.\n' + 'Only a Page can contain an ActionBar, so please ensure ActionBar is only used inside a Component that is routed via page-router-outlet or is contained in a Page.\n' + 'Example for root action bars in AppComponent: <Frame><Page><ActionBar>....</ActionBar></Page></Frame>');
        }
        if (isBlank(this.page.actionBarHidden)) {
            this.page.actionBarHidden = false;
        }
        this.page.actionBar = this.element.nativeElement;
        this.page.actionBar.update();
    }
}
ActionBarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: ActionBarComponent, deps: [{ token: i0.ElementRef }, { token: i1.Page, optional: true }], target: i0.ɵɵFactoryTarget.Component });
ActionBarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.2", type: ActionBarComponent, selector: "ActionBar", ngImport: i0, template: '<ng-content></ng-content>', isInline: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: ActionBarComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ActionBar',
                    template: '<ng-content></ng-content>',
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.Page, decorators: [{
                    type: Optional
                }] }]; } });
// eslint-disable-next-line @angular-eslint/component-class-suffix
export class ActionBarScope {
    // tslint:disable-line:component-class-suffix
    constructor(page) {
        this.page = page;
        if (!this.page) {
            throw new Error('Inside ActionBarExtension but no ActionBar found to extend.');
        }
    }
    onNavButtonInit(navBtn) {
        this.page.actionBar.navigationButton = navBtn.element.nativeElement;
    }
    onNavButtonDestroy(navBtn) {
        const nav = navBtn.element.nativeElement;
        if (nav && this.page.actionBar.navigationButton === nav) {
            this.page.actionBar.navigationButton = null;
        }
    }
    onActionInit(item) {
        this.page.actionBar.actionItems.addItem(item.element.nativeElement);
    }
    onActionDestroy(item) {
        if (item.element.nativeElement.actionBar) {
            this.page.actionBar.actionItems.removeItem(item.element.nativeElement);
        }
    }
}
ActionBarScope.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: ActionBarScope, deps: [{ token: i1.Page, optional: true }], target: i0.ɵɵFactoryTarget.Component });
ActionBarScope.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.2", type: ActionBarScope, selector: "ActionBarExtension", ngImport: i0, template: '', isInline: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: ActionBarScope, decorators: [{
            type: Component,
            args: [{
                    selector: 'ActionBarExtension',
                    template: '',
                }]
        }], ctorParameters: function () { return [{ type: i1.Page, decorators: [{
                    type: Optional
                }] }]; } });
export class ActionItemDirective {
    constructor(element, ownerScope) {
        this.element = element;
        this.ownerScope = ownerScope;
        if (this.ownerScope) {
            this.ownerScope.onActionInit(this);
        }
    }
    ngOnDestroy() {
        if (this.ownerScope) {
            this.ownerScope.onActionDestroy(this);
        }
    }
}
ActionItemDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: ActionItemDirective, deps: [{ token: i0.ElementRef }, { token: ActionBarScope, optional: true }], target: i0.ɵɵFactoryTarget.Directive });
ActionItemDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "15.2.2", type: ActionItemDirective, selector: "ActionItem", ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: ActionItemDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'ActionItem', // tslint:disable-line:directive-selector
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: ActionBarScope, decorators: [{
                    type: Optional
                }] }]; } });
export class NavigationButtonDirective {
    constructor(element, ownerScope) {
        this.element = element;
        this.ownerScope = ownerScope;
        if (this.ownerScope) {
            this.ownerScope.onNavButtonInit(this);
        }
    }
    ngOnDestroy() {
        if (this.ownerScope) {
            this.ownerScope.onNavButtonDestroy(this);
        }
    }
}
NavigationButtonDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: NavigationButtonDirective, deps: [{ token: i0.ElementRef }, { token: ActionBarScope, optional: true }], target: i0.ɵɵFactoryTarget.Directive });
NavigationButtonDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "15.2.2", type: NavigationButtonDirective, selector: "NavigationButton", ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: NavigationButtonDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'NavigationButton', // tslint:disable-line:directive-selector
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: ActionBarScope, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9hbmd1bGFyL3NyYy9saWIvY2RrL2FjdGlvbi1iYXIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUN0RixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBZSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVoRyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7OztBQUV6RCxNQUFNLFVBQVUsWUFBWSxDQUFDLElBQVM7SUFDcEMsT0FBTyxJQUFJLFlBQVksVUFBVSxDQUFDO0FBQ3BDLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQUMsSUFBUztJQUMxQyxPQUFPLElBQUksWUFBWSxnQkFBZ0IsQ0FBQztBQUMxQyxDQUFDO0FBSUQsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFrQjtJQUMxQyxZQUFZLEVBQUUsSUFBSTtJQUNsQixXQUFXLEVBQUUsQ0FBQyxNQUFtQixFQUFFLEtBQWEsRUFBRSxJQUFTLEVBQUUsRUFBRTtRQUM3RCxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMxQixPQUFPO1NBQ1I7YUFBTSxJQUFJLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3BDLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7WUFDaEMsS0FBSyxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7U0FDM0I7YUFBTSxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFB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TyxDQUFZO1FBQXNCLGVBQVUsR0FBVixVQUFVLENBQWdCO1FBQ3BGLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN2QztJQUNILENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ25CLElBQUksQ0FBQyxVQUFVLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDMUM7SUFDSCxDQUFDOztzSEFYVSx5QkFBeUI7MEdBQXpCLHlCQUF5QjsyRkFBekIseUJBQXlCO2tCQUhyQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxrQkFBa0IsRUFBRSx5Q0FBeUM7aUJBQ3hFOzswQkFFMEMsUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPcHRpb25hbCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3Rpb25CYXIsIEFjdGlvbkl0ZW0sIEFjdGlvbkl0ZW1zLCBOYXZpZ2F0aW9uQnV0dG9uLCBQYWdlIH0gZnJvbSAnQG5hdGl2ZXNjcmlwdC9jb3JlJztcblxuaW1wb3J0IHsgaXNCbGFuayB9IGZyb20gJy4uLy4uL3V0aWxzL2xhbmctZmFjYWRlJztcbmltcG9ydCB7IE5nVmlldywgVmlld0NsYXNzTWV0YSwgVmlld0V4dGVuc2lvbnMgfSBmcm9tICcuLi8uLi92aWV3cy92aWV3LXR5cGVzJztcbmltcG9ydCB7IGlzSW52aXNpYmxlTm9kZSwgaXNWaWV3IH0gZnJvbSAnLi4vLi4vdmlld3MvdXRpbHMnO1xuaW1wb3J0IHsgcmVnaXN0ZXJFbGVtZW50IH0gZnJvbSAnLi4vLi4vZWxlbWVudC1yZWdpc3RyeSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0FjdGlvbkl0ZW0odmlldzogYW55KTogdmlldyBpcyBBY3Rpb25JdGVtIHtcbiAgcmV0dXJuIHZpZXcgaW5zdGFuY2VvZiBBY3Rpb25JdGVtO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNOYXZpZ2F0aW9uQnV0dG9uKHZpZXc6IGFueSk6IHZpZXcgaXMgTmF2aWdhdGlvbkJ1dHRvbiB7XG4gIHJldHVybiB2aWV3IGluc3RhbmNlb2YgTmF2aWdhdGlvbkJ1dHRvbjtcbn1cblxudHlwZSBOZ0FjdGlvbkJhciA9IEFjdGlvbkJhciAmIFZpZXdFeHRlbnNpb25zO1xuXG5leHBvcnQgY29uc3QgYWN0aW9uQmFyTWV0YTogVmlld0NsYXNzTWV0YSA9IHtcbiAgc2tpcEFkZFRvRG9tOiB0cnVlLFxuICBpbnNlcnRDaGlsZDogKHBhcmVudDogTmdBY3Rpb25CYXIsIGNoaWxkOiBOZ1ZpZXcsIG5leHQ6IGFueSkgPT4ge1xuICAgIGlmIChpc0ludmlzaWJsZU5vZGUoY2hpbGQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChpc05hdmlnYXRpb25CdXR0b24oY2hpbGQpKSB7XG4gICAgICBwYXJlbnQubmF2aWdhdGlvbkJ1dHRvbiA9IGNoaWxkO1xuICAgICAgY2hpbGQucGFyZW50Tm9kZSA9IHBhcmVudDtcbiAgICB9IGVsc2UgaWYgKGlzQWN0aW9uSXRlbShjaGlsZCkpIHtcbiAgICAgIGFkZEFjdGlvbkl0ZW0ocGFyZW50LCBjaGlsZCwgbmV4dCk7XG4gICAgICBjaGlsZC5wYXJlbnROb2RlID0gcGFyZW50O1xuICAgIH0gZWxzZSBpZiAoaXNWaWV3KGNoaWxkKSkge1xuICAgICAgcGFyZW50LnRpdGxlVmlldyA9IGNoaWxkO1xuICAgIH1cbiAgfSxcbiAgcmVtb3ZlQ2hpbGQ6IChwYXJlbnQ6IE5nQWN0aW9uQmFyLCBjaGlsZDogTmdWaWV3KSA9PiB7XG4gICAgaWYgKGlzSW52aXNpYmxlTm9kZShjaGlsZCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKGlzTmF2aWdhdGlvbkJ1dHRvbihjaGlsZCkpIHtcbiAgICAgIGlmIChwYXJlbnQubmF2aWdhdGlvbkJ1dHRvbiA9PT0gY2hpbGQpIHtcbiAgICAgICAgcGFyZW50Lm5hdmlnYXRpb25CdXR0b24gPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBjaGlsZC5wYXJlbnROb2RlID0gbnVsbDtcbiAgICB9IGVsc2UgaWYgKGlzQWN0aW9uSXRlbShjaGlsZCkpIHtcbiAgICAgIHBhcmVudC5hY3Rpb25JdGVtcy5yZW1vdmVJdGVtKGNoaWxkKTtcbiAgICAgIGNoaWxkLnBhcmVudE5vZGUgPSBudWxsO1xuICAgIH0gZWxzZSBpZiAoaXNWaWV3KGNoaWxkKSAmJiBwYXJlbnQudGl0bGVWaWV3ICYmIHBhcmVudC50aXRsZVZpZXcgPT09IGNoaWxkKSB7XG4gICAgICBwYXJlbnQudGl0bGVWaWV3ID0gbnVsbDtcbiAgICB9XG4gIH0sXG59O1xuXG5yZWdpc3RlckVsZW1lbnQoJ0FjdGlvbkJhcicsICgpID0+IEFjdGlvbkJhciwgYWN0aW9uQmFyTWV0YSk7XG5yZWdpc3RlckVsZW1lbnQoJ0FjdGlvbkl0ZW0nLCAoKSA9PiA8YW55PkFjdGlvbkl0ZW0pO1xucmVnaXN0ZXJFbGVtZW50KCdOYXZpZ2F0aW9uQnV0dG9uJywgKCkgPT4gPGFueT5OYXZpZ2F0aW9uQnV0dG9uKTtcblxuY29uc3QgYWRkQWN0aW9uSXRlbSA9IChiYXI6IE5nQWN0aW9uQmFyLCBpdGVtOiBBY3Rpb25JdGVtLCBuZXh0OiBBY3Rpb25JdGVtKSA9PiB7XG4gIGlmIChuZXh0KSB7XG4gICAgaW5zZXJ0QWN0aW9uSXRlbUJlZm9yZShiYXIsIGl0ZW0sIG5leHQpO1xuICB9IGVsc2Uge1xuICAgIGFwcGVuZEFjdGlvbkl0ZW0oYmFyLCBpdGVtKTtcbiAgfVxufTtcblxuY29uc3QgaW5zZXJ0QWN0aW9uSXRlbUJlZm9yZSA9IChiYXI6IE5nQWN0aW9uQmFyLCBpdGVtOiBBY3Rpb25JdGVtLCBuZXh0OiBBY3Rpb25JdGVtKSA9PiB7XG4gIGNvbnN0IGFjdGlvbkl0ZW1zOiBBY3Rpb25JdGVtcyA9IGJhci5hY3Rpb25JdGVtcztcbiAgY29uc3QgYWN0aW9uSXRlbXNDb2xsZWN0aW9uOiBBY3Rpb25JdGVtW10gPSBhY3Rpb25JdGVtcy5nZXRJdGVtcygpO1xuXG4gIGNvbnN0IGluZGV4VG9JbnNlcnQgPSBhY3Rpb25JdGVtc0NvbGxlY3Rpb24uaW5kZXhPZihuZXh0KTtcbiAgYWN0aW9uSXRlbXNDb2xsZWN0aW9uLnNwbGljZShpbmRleFRvSW5zZXJ0LCAwLCBpdGVtKTtcblxuICAoPGFueT5hY3Rpb25JdGVtcykuc2V0SXRlbXMoYWN0aW9uSXRlbXNDb2xsZWN0aW9uKTtcbn07XG5cbmNvbnN0IGFwcGVuZEFjdGlvbkl0ZW0gPSAoYmFyOiBOZ0FjdGlvbkJhciwgaXRlbTogQWN0aW9uSXRlbSkgPT4ge1xuICBiYXIuYWN0aW9uSXRlbXMuYWRkSXRlbShpdGVtKTtcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ0FjdGlvbkJhcicsXG4gIHRlbXBsYXRlOiAnPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PicsXG59KVxuZXhwb3J0IGNsYXNzIEFjdGlvbkJhckNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBlbGVtZW50OiBFbGVtZW50UmVmLCBAT3B0aW9uYWwoKSBwcml2YXRlIHBhZ2U6IFBhZ2UpIHtcbiAgICBpZiAoIXRoaXMucGFnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBQYWdlIGZvdW5kIGluIEFjdGlvbkJhckNvbXBvbmVudC5cXG4nICsgJ09ubHkgYSBQYWdlIGNhbiBjb250YWluIGFuIEFjdGlvbkJhciwgc28gcGxlYXNlIGVuc3VyZSBBY3Rpb25CYXIgaXMgb25seSB1c2VkIGluc2lkZSBhIENvbXBvbmVudCB0aGF0IGlzIHJvdXRlZCB2aWEgcGFnZS1yb3V0ZXItb3V0bGV0IG9yIGlzIGNvbnRhaW5lZCBpbiBhIFBhZ2UuXFxuJyArICdFeGFtcGxlIGZvciByb290IGFjdGlvbiBiYXJzIGluIEFwcENvbXBvbmVudDogPEZyYW1lPjxQYWdlPjxBY3Rpb25CYXI+Li4uLjwvQWN0aW9uQmFyPjwvUGFnZT48L0ZyYW1lPicpO1xuICAgIH1cblxuICAgIGlmIChpc0JsYW5rKHRoaXMucGFnZS5hY3Rpb25CYXJIaWRkZW4pKSB7XG4gICAgICB0aGlzLnBhZ2UuYWN0aW9uQmFySGlkZGVuID0gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMucGFnZS5hY3Rpb25CYXIgPSB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICB0aGlzLnBhZ2UuYWN0aW9uQmFyLnVwZGF0ZSgpO1xuICB9XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ0FjdGlvbkJhckV4dGVuc2lvbicsXG4gIHRlbXBsYXRlOiAnJyxcbn0pXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L2NvbXBvbmVudC1jbGFzcy1zdWZmaXhcbmV4cG9ydCBjbGFzcyBBY3Rpb25CYXJTY29wZSB7XG4gIC8vIHRzbGludDpkaXNhYmxlLWxpbmU6Y29tcG9uZW50LWNsYXNzLXN1ZmZpeFxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwcml2YXRlIHBhZ2U6IFBhZ2UpIHtcbiAgICBpZiAoIXRoaXMucGFnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnNpZGUgQWN0aW9uQmFyRXh0ZW5zaW9uIGJ1dCBubyBBY3Rpb25CYXIgZm91bmQgdG8gZXh0ZW5kLicpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvbk5hdkJ1dHRvbkluaXQobmF2QnRuOiBOYXZpZ2F0aW9uQnV0dG9uRGlyZWN0aXZlKSB7XG4gICAgdGhpcy5wYWdlLmFjdGlvbkJhci5uYXZpZ2F0aW9uQnV0dG9uID0gbmF2QnRuLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgfVxuXG4gIHB1YmxpYyBvbk5hdkJ1dHRvbkRlc3Ryb3kobmF2QnRuOiBOYXZpZ2F0aW9uQnV0dG9uRGlyZWN0aXZlKSB7XG4gICAgY29uc3QgbmF2ID0gPE5hdmlnYXRpb25CdXR0b24+bmF2QnRuLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICBpZiAobmF2ICYmIHRoaXMucGFnZS5hY3Rpb25CYXIubmF2aWdhdGlvbkJ1dHRvbiA9PT0gbmF2KSB7XG4gICAgICB0aGlzLnBhZ2UuYWN0aW9uQmFyLm5hdmlnYXRpb25CdXR0b24gPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvbkFjdGlvbkluaXQoaXRlbTogQWN0aW9uSXRlbURpcmVjdGl2ZSkge1xuICAgIHRoaXMucGFnZS5hY3Rpb25CYXIuYWN0aW9uSXRlbXMuYWRkSXRlbShpdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG4gIH1cblxuICBwdWJsaWMgb25BY3Rpb25EZXN0cm95KGl0ZW06IEFjdGlvbkl0ZW1EaXJlY3RpdmUpIHtcbiAgICBpZiAoaXRlbS5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuYWN0aW9uQmFyKSB7XG4gICAgICB0aGlzLnBhZ2UuYWN0aW9uQmFyLmFjdGlvbkl0ZW1zLnJlbW92ZUl0ZW0oaXRlbS5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpO1xuICAgIH1cbiAgfVxufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdBY3Rpb25JdGVtJywgLy8gdHNsaW50OmRpc2FibGUtbGluZTpkaXJlY3RpdmUtc2VsZWN0b3Jcbn0pXG5leHBvcnQgY2xhc3MgQWN0aW9uSXRlbURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBlbGVtZW50OiBFbGVtZW50UmVmLCBAT3B0aW9uYWwoKSBwcml2YXRlIG93bmVyU2NvcGU6IEFjdGlvbkJhclNjb3BlKSB7XG4gICAgaWYgKHRoaXMub3duZXJTY29wZSkge1xuICAgICAgdGhpcy5vd25lclNjb3BlLm9uQWN0aW9uSW5pdCh0aGlzKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5vd25lclNjb3BlKSB7XG4gICAgICB0aGlzLm93bmVyU2NvcGUub25BY3Rpb25EZXN0cm95KHRoaXMpO1xuICAgIH1cbiAgfVxufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdOYXZpZ2F0aW9uQnV0dG9uJywgLy8gdHNsaW50OmRpc2FibGUtbGluZTpkaXJlY3RpdmUtc2VsZWN0b3Jcbn0pXG5leHBvcnQgY2xhc3MgTmF2aWdhdGlvbkJ1dHRvbkRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBlbGVtZW50OiBFbGVtZW50UmVmLCBAT3B0aW9uYWwoKSBwcml2YXRlIG93bmVyU2NvcGU6IEFjdGlvbkJhclNjb3BlKSB7XG4gICAgaWYgKHRoaXMub3duZXJTY29wZSkge1xuICAgICAgdGhpcy5vd25lclNjb3BlLm9uTmF2QnV0dG9uSW5pdCh0aGlzKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5vd25lclNjb3BlKSB7XG4gICAgICB0aGlzLm93bmVyU2NvcGUub25OYXZCdXR0b25EZXN0cm95KHRoaXMpO1xuICAgIH1cbiAgfVxufVxuIl19